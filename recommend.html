<HTML >
  <HEAD>
    <title>Skills pointer - recommend a colleague!</title>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript" src="db.js"></script>

  </HEAD> 
  <body>
    <p id="welcome"></p>

    Mon collègue
    <input id="name" type="text" placeholder="ex: Marie">
    m'a aidé avec
    <input id="skill" type="text" placeholder="compétence">
    <button onclick="recommend()">recommander</button>

    <div id="result"></div>

    <script>
      let persons = db.get('persons');
      let recommendations = db.get('recommendations');

      var user = persons[3];
      $('#welcome').text('Welcome ' + user.name + '!');
      
      function recommend() {
        let name = document.getElementById("name").value
        let skill = document.getElementById("skill").value

        let searchResults = persons.filter(p => p.name == name);
        var recommendee;
        if (searchResults.length == 0) {
          var personId = searchResults.length + 1;
          recommendee = {
            "id": personId,
            "name": name,
            "location": "Meylan"
          };
          persons.push(recommendee);
        } else {
          recommendee = searchResults[0];
        }

        recommendation = {recommender: user.id, recommendee: recommendee.id, skill: skill};
        recommendations.push(recommendation);

        db.set('persons',persons);
        db.set('recommendations',recommendations);
        //console.log(persons, recommendations);
      }
    </script>
  </body>
</HTML>